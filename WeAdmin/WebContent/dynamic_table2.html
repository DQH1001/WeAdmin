<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="ThemeBucket">
  <link rel="shortcut icon" href="#" type="image/png">
  <title>Dynamic Table</title>
 <link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">

   <!--dynamic table-->
  <link href="js/advanced-datatable/css/demo_page.css" rel="stylesheet" />
  <link href="js/advanced-datatable/css/demo_table.css" rel="stylesheet" />
  <link rel="stylesheet" href="js/data-tables/DT_bootstrap.css" />
  <link href="css/layer.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet">

 <link rel="stylesheet" href="css/bootstrap-table.css" />
 <!-- 	
 HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side">

        <!--logo and iconic logo start-->
        <div class="logo">
            <a href="index.html"><img src="images/logo.png" alt=""></a>
        </div>

        <div class="logo-icon text-center">
            <a href="index.html"><img src="images/logo_icon.png" alt=""></a>
        </div>
        <!--logo and iconic logo end-->


        <div class="left-side-inner">

            <!-- visible to small devices only -->
            <div class="visible-xs hidden-sm hidden-md hidden-lg">
                <div class="media logged-user">
                    <img alt="" src="images/photos/user-avatar.png" class="media-object">
                    <div class="media-body">
                        <h4><a href="#">John Doe</a></h4>
                        <span>"Hello There..."</span>
                    </div>
                </div>

                <h5 class="left-nav-title">Account Information</h5>
                <ul class="nav nav-pills nav-stacked custom-nav">
                    <li><a href="#"><i class="fa fa-user"></i> <span>Profile</span></a></li>
                    <li><a href="#"><i class="fa fa-cog"></i> <span>Settings</span></a></li>
                    <li><a href="#"><i class="fa fa-sign-out"></i> <span>Sign Out</span></a></li>
                </ul>
            </div>

            <!--sidebar nav start-->
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li><a href="index.html"><i class="fa fa-home"></i> <span>Dashboard</span></a></li>
                <li class="menu-list" id="layout2">
					<a href=""><i class="fa fa-laptop"></i> <span>Layouts</span></a>
                    <ul class="sub-menu-list">
                        <li ><a href="blank_page.html"> Blank Page</a></li>
                        <li><a href="boxed_view.html"> Boxed Page</a></li>
                        <li><a href="leftmenu_collapsed_view.html"> Sidebar Collapsed</a></li>
                        <li><a href="horizontal_menu.html"> Horizontal Menu</a></li>

                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-book"></i> <span>UI Elements</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="general.html"> General</a></li>
                        <li><a href="buttons.html"> Buttons</a></li>
                        <li><a href="tabs-accordions.html"> Tabs & Accordions</a></li>
                        <li><a href="typography.html"> Typography</a></li>
                        <li><a href="slider.html"> Slider</a></li>
                        <li><a href="panels.html"> Panels</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>Components</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="grids.html"> Grids</a></li>
                        <li><a href="gallery.html"> Media Gallery</a></li>
                        <li><a href="calendar.html"> Calendar</a></li>
                        <li><a href="tree_view.html"> Tree View</a></li>
                        <li><a href="nestable.html"> Nestable</a></li>

                    </ul>
                </li>

                <li><a href="fontawesome.html"><i class="fa fa-bullhorn"></i> <span>Fontawesome</span></a></li>

                <li class="menu-list"><a href=""><i class="fa fa-envelope"></i> <span>Mail</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="mail.html"> Inbox</a></li>
                        <li><a href="mail_compose.html"> Compose Mail</a></li>
                        <li><a href="mail_view.html"> View Mail</a></li>
                    </ul>
                </li>

                <li class="menu-list"><a href=""><i class="fa fa-tasks"></i> <span>Forms</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="form_layouts.html"> Form Layouts</a></li>
                        <li><a href="form_advanced_components.html"> Advanced Components</a></li>
                        <li><a href="form_wizard.html"> Form Wizards</a></li>
                        <li><a href="form_validation.html"> Form Validation</a></li>
                        <li><a href="editors.html"> Editors</a></li>
                        <li><a href="inline_editors.html"> Inline Editors</a></li>
                        <li><a href="pickers.html"> Pickers</a></li>
                        <li><a href="dropzone.html"> Dropzone</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-bar-chart-o"></i> <span>Charts</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="flot_chart.html"> Flot Charts</a></li>
                        <li><a href="morris.html"> Morris Charts</a></li>
                        <li><a href="chartjs.html"> Chartjs</a></li>
                        <li><a href="c3chart.html"> C3 Charts</a></li>
                    </ul>
                </li>
                <li class="menu-list nav-active"><a href="#"><i class="fa fa-th-list"></i> <span>Data Tables</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="basic_table.html"> Basic Table</a></li>
                        <li class="active"><a href="dynamic_table.html"> Advanced Table</a></li>
                        <li><a href="responsive_table.html"> Responsive Table</a></li>
                        <li><a href="editable_table.html"> Edit Table</a></li>
                    </ul>
                </li>

                <li class="menu-list"><a href="#"><i class="fa fa-map-marker"></i> <span>Maps</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="google_map.html"> Google Map</a></li>
                        <li><a href="vector_map.html"> Vector Map</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-file-text"></i> <span>Extra Pages</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="profile.html"> Profile</a></li>
                        <li><a href="invoice.html"> Invoice</a></li>
                        <li><a href="pricing_table.html"> Pricing Table</a></li>
                        <li><a href="timeline.html"> Timeline</a></li>
                        <li><a href="blog_list.html"> Blog List</a></li>
                        <li><a href="blog_details.html"> Blog Details</a></li>
                        <li><a href="directory.html"> Directory </a></li>
                        <li><a href="chat.html"> Chat </a></li>
                        <li><a href="404.html"> 404 Error</a></li>
                        <li><a href="500.html"> 500 Error</a></li>
                        <li><a href="registration.html"> Registration Page</a></li>
                        <li><a href="lock_screen.html"> Lockscreen </a></li>
                    </ul>
                </li>
                <li><a href="login.html"><i class="fa fa-sign-in"></i> <span>Login Page</span></a></li>

            </ul>
            <!--sidebar nav end-->

        </div>
    </div>
    <!-- left side end-->
    
    <!-- main content start-->
    <div class="main-content" >

        <!-- header section start-->
        <div class="header-section">

        <!--toggle button start-->
        <a class="toggle-btn"><i class="fa fa-bars"></i></a>
        <!--toggle button end-->

        <!--search start-->
        <form class="searchform" action="index.html" method="post">
            <input type="text" class="form-control" name="keyword" placeholder="Search here..." />
        </form>
        <!--search end-->

        <!--notification menu start -->
        <div class="menu-right">
            <ul class="notification-menu">
                <li>
                    <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                        <i class="fa fa-tasks"></i>
                        <span class="badge">8</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-head pull-right">
                        <h5 class="title">You have 8 pending task</h5>
                        <ul class="dropdown-list user-list">
                            <li class="new">
                                <a href="#">
                                    <div class="task-info">
                                        <div>Database update</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div style="width: 40%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="40" role="progressbar" class="progress-bar progress-bar-warning">
                                            <span class="">40%</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li class="new">
                                <a href="#">
                                    <div class="task-info">
                                        <div>Dashboard done</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div style="width: 90%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="90" role="progressbar" class="progress-bar progress-bar-success">
                                            <span class="">90%</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <div class="task-info">
                                        <div>Web Development</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div style="width: 66%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="66" role="progressbar" class="progress-bar progress-bar-info">
                                            <span class="">66% </span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <div class="task-info">
                                        <div>Mobile App</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div style="width: 33%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="33" role="progressbar" class="progress-bar progress-bar-danger">
                                            <span class="">33% </span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <div class="task-info">
                                        <div>Issues fixed</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div style="width: 80%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="80" role="progressbar" class="progress-bar">
                                            <span class="">80% </span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li class="new"><a href="">See All Pending Task</a></li>
                        </ul>
                    </div>
                </li>
                <li>
                    <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                        <i class="fa fa-envelope-o"></i>
                        <span class="badge">5</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-head pull-right">
                        <h5 class="title">You have 5 Mails </h5>
                        <ul class="dropdown-list normal-list">
                            <li class="new">
                                <a href="">
                                    <span class="thumb"><img src="images/photos/user1.png" alt="" /></span>
                                        <span class="desc">
                                          <span class="name">John Doe <span class="badge badge-success">new</span></span>
                                          <span class="msg">Lorem ipsum dolor sit amet...</span>
                                        </span>
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    <span class="thumb"><img src="images/photos/user2.png" alt="" /></span>
                                        <span class="desc">
                                          <span class="name">Jonathan Smith</span>
                                          <span class="msg">Lorem ipsum dolor sit amet...</span>
                                        </span>
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    <span class="thumb"><img src="images/photos/user3.png" alt="" /></span>
                                        <span class="desc">
                                          <span class="name">Jane Doe</span>
                                          <span class="msg">Lorem ipsum dolor sit amet...</span>
                                        </span>
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    <span class="thumb"><img src="images/photos/user4.png" alt="" /></span>
                                        <span class="desc">
                                          <span class="name">Mark Henry</span>
                                          <span class="msg">Lorem ipsum dolor sit amet...</span>
                                        </span>
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    <span class="thumb"><img src="images/photos/user5.png" alt="" /></span>
                                        <span class="desc">
                                          <span class="name">Jim Doe</span>
                                          <span class="msg">Lorem ipsum dolor sit amet...</span>
                                        </span>
                                </a>
                            </li>
                            <li class="new"><a href="">Read All Mails</a></li>
                        </ul>
                    </div>
                </li>
                <li>
                    <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                        <i class="fa fa-bell-o"></i>
                        <span class="badge">4</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-head pull-right">
                        <h5 class="title">Notifications</h5>
                        <ul class="dropdown-list normal-list">
                            <li class="new">
                                <a href="">
                                    <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                                    <span class="name">Server #1 overloaded.  </span>
                                    <em class="small">34 mins</em>
                                </a>
                            </li>
                            <li class="new">
                                <a href="">
                                    <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                                    <span class="name">Server #3 overloaded.  </span>
                                    <em class="small">1 hrs</em>
                                </a>
                            </li>
                            <li class="new">
                                <a href="">
                                    <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                                    <span class="name">Server #5 overloaded.  </span>
                                    <em class="small">4 hrs</em>
                                </a>
                            </li>
                            <li class="new">
                                <a href="">
                                    <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                                    <span class="name">Server #31 overloaded.  </span>
                                    <em class="small">4 hrs</em>
                                </a>
                            </li>
                            <li class="new"><a href="">See All Notifications</a></li>
                        </ul>
                    </div>
                </li>
                <li>
                    <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                        <img src="images/photos/user-avatar.png" alt="" />
                        John Doe
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-usermenu pull-right">
                        <li><a href="#"><i class="fa fa-user"></i>  Profile</a></li>
                        <li><a href="#"><i class="fa fa-cog"></i>  Settings</a></li>
                        <li><a href="#"><i class="fa fa-sign-out"></i> Log Out</a></li>
                    </ul>
                </li>

            </ul>
        </div>
        <!--notification menu end -->

        </div>
        <!-- header section end-->

        <!-- page heading start-->
        <div class="page-heading">
       
            <h3>
                Dynamic Table
            </h3>
            <ul class="breadcrumb">
                <li>
                    <a href="#">Dashboard</a>
                </li>
                <li>
                    <a href="#">Data Tables</a>
                </li>
                <li class="active"> Dynamic Table </li>
            </ul>
        </div>
        <!-- page heading end-->

        <!--body wrapper start-->
        <div class="wrapper">
        <div class="row">
        <div class="col-sm-12">
        <section class="panel">
        <header class="panel-heading">
            Dynamic Table
           
        </header>
        <div class="panel-body">
		 		
							<!---->
        <table id="table1"
		>      
        </table>
       
        </div>
        </section>
		<!---->
		<section class="panel">
        <header class="panel-heading">
            Dynamic Table
          
        </header>
        <div class="panel-body">
           <div class="table-box" style="margin: 20px;" id="searchForm1">
				<div id="toolbar">
					<button id="allUpdate" class="btn btn-default">一键修改</button>
					<button id="okUpdate" class="btn btn-default">确认修改</button>
				
					<!--  <a href="javascript:;" class="btn btn-primary" id="addColumn">addClumn</a> -->
					原始：<span id="numm"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					修改后：<span id="numm2"></span>
				</div>				
			</div>
		 		
							<!---->
        <table id="table1">
		 
        </table>
     
        </div>
        </section>
        </div>
        </div>
       
        </div>
        <!--body wrapper end-->

        <!--footer section start-->
        <footer>
            2014 &copy; AdminEx by ThemeBucket
        </footer>
        <!--footer section end-->


    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/jquery.nicescroll.js"></script>
<!--dynamic table-->
<script src="js/bootstrap-table.js"></script>  
<script src="js/bootstrap-table-export.js"></script>
<script src="js/bootstrap-table-zh-CN.js"></script>
<script src="js/tableExport.js"></script>
	<script src="js/layer.js"></script>
<script type="text/javascript" language="javascript"
 src="js/advanced-datatable/js/jquery.dataTables.js"></script>
<script type="text/javascript" src="js/data-tables/DT_bootstrap.js"></script>
<!--dynamic table initialization -->
<script src="js/dynamic_table_init.js"></script>

<!--common scripts for all pages-->
<script src="js/scripts.js"></script>
<script>
	$(document).ready(function(){
		//okUpdate numm numm2

		$("#okUpdate").click(function(){
			var numm=$("#numm").html();
			var numm2=$("#numm2").html();
			if(numm==numm2){
				var ids="";
				var changces="";
				//alert("ok");
				//获取整个table的所有值,变成json对象
				var deptlist=JSON.stringify($("#table1").bootstrapTable('getData'));
				//如果遍历的时候还需要JSON.parse 转化
				deptlist=JSON.parse(deptlist);
				$.each(deptlist,function(i){
				    $.each(deptlist[i],function(k,v){					
					   //比对和遍历只是两列,只是手动修改值的那一列
					   if("infoid"==k){
						   ids+=(parseInt(v)+";");
					   }
					   if("cnumChange"==k){
						   changces+=(parseInt(v)+";");
					   }
					})
				});
				var data={
						"ids":ids,
						"changces":changces
				}
				$.ajax({
					url:'updateYzTable',
					method:'post',
					data:data,
					dataType:'text',
					success:function(data){
						if(data.indexOf("ok")!=-1){
							layer.msg("修改成功");
						}else{
							layer.msg("修改失败");
						}
						
					},
					error:function(){
						alert("error")
						
					}
				});
			}else{
				layer.msg("前后修改不一致，请重新编辑");
			}
		});
		$("#layout2").hide();		
		$("#table1").bootstrapTable({
	        //contentType: "application/x-www-form-urlencoded",//必须要有！！！！
			url: 'selectCompsAllForT2',
			method : 'get', //
			toolbar: '#searchForm1',//searchForm1        
			pagination : true, //是否显示分页（*）
			//queryParams : queryParams,
	         pageSize : 5, //初始化页大小
				pageList : [ 3, 5, 10 ],//data-page-list="[4, 7, 15]"
				singleSelect : false,
				sortable : true, //是否启用排序 				
				sidePagination : "client", //分页方式：client客户端分页，server服务端分页（*）
				strictSearch : true,
				minimumCountColumns : 2, //最少允许的列数
				clickToSelect : true, //是否启用点击选中行
				showRefresh : false, //是否显示刷新按钮
				uniqueId : "uid", //每一行的唯一标识，一般为主键列
				//cardView : true, //是否显示详细视图
				search : true,
				strictSearch : true,
				showColumns : true,
				showRefresh : true,
				showExport:true,
			onLoadError : function(data) {
				$('#table1').bootstrapTable('removeAll');
			},	
			//
			columns : [{
				field : 'infoid',
				title : '公司ID1',
				align : 'center',
	            sortable : true
			}, {
				field : 'uname',
				title : '公司Name',
				align : 'center',
	            sortable : true
			},{
				field : 'basicNum',
				title : '原先人数',
				align : 'center',
	            sortable : true
			},{
				field : 'iattendance',
				title : '修改后的人数',
				align : 'center',
	            sortable : true
			},{
				field : 'cnumChange',
				title : '原人数基础上',
				align : 'center',
	            sortable : true
			},{
		        title: '操作',
		        field: 'un',
		        align: 'center',
		        formatter:function(value,row,index){						
		        //把之前的列表链接 一行记录json {“uid”:2,"uname":....}	就是参数 row
		        	var d ="<a href='javascript:void(0);' media='"+row.c_pros+
		        	"' title='"+row.cid+"' id='delequ' class='btn btn-success' >Detail</a>";
		        	//row.uid得bootstrap当前table的一行找到   
		        	return d;
		        }
		    }],
			onDblClickCell: function(field, value, row, $element) {
				var beforechangce=row.iattendance;
				var afterchangce=row.iattendance;
				var rightcell=row.cnumChange;
				//错误的逻辑: 第一次双击的时候计算和显示所有没调剂之前的人数总和
				if(firstNum==0){
				   saveNumber();
				}
				//只能接受一列可以手动修改数字
				if(field=="iattendance"){
					
					//改变可以修改的状态脚本
					$element.attr('contenteditable', true);//编辑状态了
					//鼠标焦点离开的时候,之前编辑的单元格又不是编辑状态了,触发事件
					$element.blur(function() {
						//获取编辑的类的id和 value
						let index = $element.parent().data('index');
						let tdValue = $element.html();
						//修改bootstrapTable显示的内容
						afterchangce=tdValue;
						var changce=rightcell+(afterchangce-beforechangce);
						saveData(index, field, tdValue,changce);
						getTableData();
					})
				}else{
					//点击其他不能让院长手动编辑的单元格,不能编辑状态
				   alert(value+" - "+row.uname);	
				}	
			}
	   });
	   $("#insertButton").click(function() {
        //$("#table1").bootstrapTable('insertRow', {
          //  index: 0,
           // row: {
              //  id: '',
              //  name: '',
              //  price: ''
           // }
        //});
    });
	
	var firstNum=0;		
	function saveNumber(){
		var deptlist=JSON.stringify($("#table1").bootstrapTable('getData'));
		//alert(deptlist);
		deptlist=JSON.parse(deptlist);
		$.each(deptlist,function(i){
		    $.each(deptlist[i],function(k,v){	
			   if("iattendance"==k){
				   firstNum+=parseInt(v);
			   }
			})
		})
		//$("#numm").html("原始:"+firstNum);
		$("#numm").html(firstNum);
		$("#numm2").html(firstNum);
	}
	   //$('#getTableData').click(function() {
		function getTableData(){
		    var second=0;
			//获取整个table的所有值,变成json对象
			var deptlist=JSON.stringify($("#table1").bootstrapTable('getData'));
			//如果遍历的时候还需要JSON.parse 转化
			deptlist=JSON.parse(deptlist);
			$.each(deptlist,function(i){
			    $.each(deptlist[i],function(k,v){					
				   //比对和遍历只是两列,只是手动修改值的那一列
				   if("iattendance"==k){
					   second+=parseInt(v);
				   }
				})
			})
			//$("#numm").html("原始:"+firstNum+",修改后:"+second);
			$("#numm").html(firstNum);
			$("#numm2").html(second);
		}
	  // });
	   //
	   function saveData(index, field, value,changce) {
		  // alert(changce);
			$("#table1").bootstrapTable('updateCell', {
				index: index,       //行索引
				field: field,       //列名
				value: value        //cell值
			});
			$("#table1").bootstrapTable('updateCell', {
				index: index,       //行索引
				field: 'cnumChange',       //列名
				value: changce        //cell值
			})
		}
	  
	});
</script>
</body>
</html>
