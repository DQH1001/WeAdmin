<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="ThemeBucket">
  <link rel="shortcut icon" href="#" type="image/png">
  <!--<link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
   <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css"/>-->

  <title>Dynamic Table</title>
 <link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
   	<link rel="stylesheet" type="text/css" href="css/sweetalert.css">
   <!--dynamic table-->
  <link href="js/advanced-datatable/css/demo_page.css" rel="stylesheet" />
  <link href="js/advanced-datatable/css/demo_table.css" rel="stylesheet" />
  <link rel="stylesheet" href="js/data-tables/DT_bootstrap.css" />

  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet">

 <link rel="stylesheet" href="css/bootstrap-table.css" />
 
 <link rel="stylesheet" type="text/css" href="js/bootstrap-datepicker/css/datepicker-custom.css" />
 <link rel="stylesheet" type="text/css" href="js/bootstrap-daterangepicker/daterangepicker-bs3.css" />
  <link rel="stylesheet" type="text/css" href="js/bootstrap-datetimepicker/css/datetimepicker-custom.css" />
   <!--file upload-->
    <link rel="stylesheet" type="text/css" href="css/bootstrap-fileupload.min.css" />
    <!-- char图 -->
     <link rel="icon" href="https://static.jianshukeji.com/highcharts/images/favicon.ico">

 
</head>

<body class="sticky-header">

    <!-- left side start-->
    <div class="left-side sticky-left-side">
        <div class="left-side-inner">
            <!--sidebar nav start-->
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li><a href="index.html"><i class="fa fa-home"></i> <span>主目录</span></a></li>
 <li><a href="login.html" id="logout"><i class="fa fa-sign-out"></i>跳转登录</a></li>
                <li><a href="fontawesome.html" id="awesome"><i class="fa fa-bullhorn"></i> <span>Fontawesome</span></a></li>

                <li class="menu-list" id="mail"><a href=""><i class="fa fa-envelope"></i> <span>Mail</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="mail.html"> Inbox</a></li>
                        <li><a href="mail_compose.html"> Compose Mail</a></li>
                        <li><a href="mail_view.html"> View Mail</a></li>
                    </ul>
                </li>

                <li class="menu-list" id="forms"><a href=""><i class="fa fa-tasks"></i> <span>Forms</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="form_layouts.html"> Form Layouts</a></li>
                        <li><a href="form_advanced_components.html"> Advanced Components</a></li>
                        <li><a href="form_wizard.html"> Form Wizards</a></li>
                        <li><a href="form_validation.html"> Form Validation</a></li>
                        <li><a href="editors.html"> Editors</a></li>
                        <li><a href="inline_editors.html"> Inline Editors</a></li>
                        <li><a href="pickers.html"> Pickers</a></li>
                        <li><a href="dropzone.html"> Dropzone</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-bar-chart-o"></i> <span>Charts</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="flot_chart.html"> Flot Charts</a></li>
                        <li><a href="morris.html"> Morris Charts</a></li>
                        <li><a href="chartjs.html"> Chartjs</a></li>
                        <li><a href="c3chart.html"> C3 Charts</a></li>
                    </ul>
                </li>
            </ul>
            <!--sidebar nav end-->

        </div>
    </div>
    <!-- left side end-->
    
    <!-- main content start-->
    <div class="main-content" >

       
       
        <div class="wrapper">
        <div class="row">
        <div class="col-sm-12">
        <section class="panel">
        
        <div class="panel-body">
			 
			   <div class="form-group" id="searchForm1">	
					<!--	 -->	 				  
			          <a class="btn btn-primary"  data-toggle="modal" onclick="outXls()">
			                导出数据
			          </a>
			          <a class="btn btn-primary"  data-toggle="modal" href="#myModal3">
			                批量添加
			          </a>   

			 </div>
         <div class="modal fade" id="myModal3" tabindex="-1" role="dialog" 
                                    aria-labelledby="myModalLabel" aria-hidden="true">
                                 <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title">批量添加</h4>
                                        </div>
                                        <div class="modal-body">
                                            <form action="#" class="form-horizontal " 
                                            enctype="multipart/form-data" id="formGrade" >
                                               
                                               
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">选择文件:</label>
                                                    <div class="col-md-6">
                                                        <div class="input-group input-large custom-date-range" data-date="13/07/2013" data-date-format="mm/dd/yyyy">
                                                           <input type="file" onclick="inputFile()" value="inputExcel"  
                                class="btn btn-primary" name="xlfile" id="xlf" />
                                                        </div>
                                                       
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                         
                                        <button data-dismiss="modal" onclick="inputFile1()" class="btn btn-primary" id="insertButtonExcel" type="button">Upload</button>
                                            <button data-dismiss="modal" class="btn btn-primary" type="button">Close</button>
                                        </div>
                                    </div>
                                </div>    
                         </div>    
        
	<table id="table10">      
	</table>
       
        </div>
        </section>
		<!---->
		
		

        
        
        			

        </div>
        </div>
        </div>

<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/jquery.nicescroll.js"></script>
<!--dynamic table-->
<script src="js/bootstrap-table.js"></script>  
<script src="js/bootstrap-table-export.js"></script>
<script src="js/bootstrap-table-zh-CN.js"></script>
<script src="js/tableExport.js"></script>

<script type="text/javascript" language="javascript"
 src="js/advanced-datatable/js/jquery.dataTables.js"></script>
<script type="text/javascript" src="js/data-tables/DT_bootstrap.js"></script>
<!--dynamic table initialization -->
<script src="js/dynamic_table_init.js"></script>

<!--common scripts for all pages-->
<script src="js/scripts.js"></script>
<!--file upload-->
<script type="text/javascript" src="js/bootstrap-fileupload.min.js"></script>
<script src="js/jquery.form.js" type="text/javascript"></script>
<script src="js/fileload.js" type="text/javascript"></script>
<script type="text/javascript" src="js/sweetalert-dev.js"></script>
<!-- char图 -->
	<script src="https://img.hcharts.cn/highcharts/highcharts.js"></script>
	<script src="https://img.hcharts.cn/highcharts/modules/data.js"></script>
	<script src="https://img.hcharts.cn/highcharts/modules/drilldown.js"></script>
	<script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>

 <script src="js/xlsx/shim.js"></script>
<script src="js/xlsx/jszip.js"></script>
<script src="js/xlsx/xlsx.js"></script>
<script src="js/xlsx/ods.js"></script>
<script type="text/javascript">



function upconTea(cid){
	$.ajax({
		url:"upComTea",
		method:"post",
		dataType:"text",
		data:{ cid:cid},
		success:function(data){
			if(data.indexOf("ok")!=-1){
				alert("成功");
				$("#table11").bootstrapTable("refresh");
			}else{
				alert("eerr");
			}
		},
		error:function(){
			alert("eerr");
		}
	});
};	

function outXls(){
	$.ajax({
		url:"xlsout",
		method:"post",
		dataType:"text",
		success:function(data){
				alert("导出成功","路径:H:/Members.xls");
		},
		error:function(){
			alert("eerr");
		}
	});
};	



var X = XLSX;
//执行上传
function inputFile1(){
	var deptlist=null;
	if(window.localStorage){
		deptlist=JSON.parse(localStorage.getItem("excellist"));
	}else{
		deptlist=Cookie.read("excellist");
	}	
	alert(deptlist);
	//poi是二进制上传， 而当前ui不是二进制上传，还是文本的参数模式
	$.ajax({
	    url: "excelStus",    //请求的url地址，获取全部roles职务的名称
	    dataType: "text",  
	    //async: true, //请求是否异步，默认为异步，这也是ajax重要特性
	    type: "post",   //请求方式，默认post	
	    //成功获取异步提交的参数执行的方法，req是返回的异步数据，类型是非常不固定
//{"UCname":usn,"UPwd":pwd,"URid":rrole,"USex":sex,"UTel":tel,"UEmail":email},
	    data:{"formdata":deptlist},
	    success:function(data) {
	    	alert("添加成功");		
	    },		   
	    error:function() {
	        //请求出错处理
	        alert("添加失败");
	    }
	});	
}
//点击<input type=file>表单:执行获取Excel并且转换json，存入缓存
function inputFile(){
// <input type="file" onclick="inputFile()" name="xlfile" id="xlf" />
    var xlf = document.getElementById('xlf');
	xlf.type="file";	
	//alert("ff: "+xlf.addEventListener);
	//当<input type="file">被点击的时候，创建的一个监听事件，xlf.addEventListener==true的时候说明该表单被点击了
	//可以视为是 onchage操作，然后触发的是方法是handleFile()方法
    if(xlf.addEventListener) {
    	xlf.addEventListener('change', handleFile, false);
    }else{
    	alert("err");
    }	
}
function ab2str(data) {
	var o = "", l = 0, w = 10240;
	for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint16Array(data.slice(l*w,l*w+w)));
	o+=String.fromCharCode.apply(null, new Uint16Array(data.slice(l*w)));
	return o;
}
function s2ab(s) {
	var b = new ArrayBuffer(s.length*2), v = new Uint16Array(b);
	for (var i=0; i != s.length; ++i) v[i] = s.charCodeAt(i);
	return [v, b];
}
function xw_xfer(data, cb) {
	var worker = new Worker('js/xlsx/xlsxworker2.js');//rABS ? XW.rABS : XW.norABS
	worker.onmessage = function(e) {
		switch(e.data.t) {
			case 'ready': break;
			case 'e': console.error(e.data.d); break;
			default: xx=ab2str(e.data).replace(/\n/g,"\\n").replace(/\r/g,"\\r"); 
			//console.log("done"); 
			cb(JSON.parse(xx)); break;
		}
	};	
		var val = s2ab(data);
		worker.postMessage(val[1], [val[1]]);	
}
function to_csv(workbook) {
	//var result = [];
	//workbook.SheetNames.forEach(function(sheetName) {
		//var csv = X.utils.sheet_to_csv(workbook.Sheets[sheetName]);
		//if(csv.length > 0){
			//result.push("SHEET: " + sheetName);					
			//result.push(csv);
			//result.push("+");
		//}
	//});
	var result = {};
	workbook.SheetNames.forEach(function(sheetName) {
		var roa = X.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
		if(roa.length > 0){
			result[sheetName] = roa;
		}
	});
	//out.innerText =result.join("\n");
	var value=JSON.stringify(result, 2, 2);
	if (window.localStorage) {
		 //封装浏览器缓存 WebStrong，setItem类似setAttribute方法
	    localStorage.setItem("excellist",JSON.stringify(value));	
	} else {
		//封装Cookie
	    Cookie.write("excellist",JSON.stringify(value));	
	}
	//ecl=JSON.stringify(value);
     //JSON.stringify(
	//alert(value);	
}
//当导入的excel 表单点击的时候触发的function方法  参数e，是导入excel文件的对象，也就是 ttt.xlsx
function handleFile(e) {
	//alert("hand:"+e);
	//获取点击的文件对象 ttt.xlsx
	var files = e.target.files;
	//获取文件中的第一个Sheet1，以下都是脚本操作文件流的代码操作
	var f = files[0];
	{
		var reader = new FileReader();
		var name = f.name;
		reader.onload = function(e) {
			//if(typeof console !== 'undefined') console.log("onload", new Date(), true, true);
			var data = e.target.result;
			xw_xfer(data, to_csv);
		};
		reader.readAsBinaryString(f);
	}
} 
</script>
</body>
</html>